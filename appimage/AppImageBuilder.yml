version: 1
script:
  # Already built before appimage-builder runs
  - echo "Using pre-built 86Box binary"

AppDir:
  path: ./AppDir
  app_info:
    id: net.86box.86Box
    name: 86Box
    icon: net.86box.86Box
    version: latest
    exec: usr/local/bin/86Box
    exec_args: $@

  apt:
    arch: arm64
    allow_unauthenticated: true
    sources:
      - sourceline: deb [trusted=yes] http://deb.debian.org/debian bullseye main
      - sourceline: deb [trusted=yes] http://security.debian.org/debian-security bullseye-security main
      - sourceline: deb [trusted=yes] http://deb.debian.org/debian bullseye-updates main
    include:
      # Core runtime
      - libc6:arm64
      - libgcc-s1:arm64
      - libstdc++6:arm64
      - libgomp1:arm64
      - zlib1g:arm64

      # Qt5 + Wayland
      - libqt5core5a:arm64
      - libqt5gui5:arm64
      - libqt5widgets5:arm64
      - libqt5network5:arm64
      - libqt5dbus5:arm64
      - libqt5qml5:arm64
      - libqt5qmlmodels5:arm64
      - libqt5quick5:arm64
      - libqt5waylandclient5:arm64
      - libqt5waylandcompositor5:arm64
      - qtwayland5:arm64

      # Display / input
      - libx11-6:arm64
      - libx11-xcb1:arm64
      - libxcb1:arm64
      - libxcb-icccm4:arm64
      - libxcb-image0:arm64
      - libxcb-keysyms1:arm64
      - libxcb-randr0:arm64
      - libxcb-render0:arm64
      - libxcb-render-util0:arm64
      - libxcb-shape0:arm64
      - libxcb-shm0:arm64
      - libxcb-sync1:arm64
      - libxcb-util1:arm64
      - libxcb-xfixes0:arm64
      - libxcb-xinerama0:arm64
      - libxcb-xinput0:arm64
      - libxcb-xkb1:arm64
      - libxau6:arm64
      - libxdmcp6:arm64
      - libxrender1:arm64
      - libxcomposite1:arm64
      - libxkbcommon0:arm64
      - libxkbcommon-x11-0:arm64
      - xkb-data:all
      - libevdev2:arm64
      - libinput10:arm64
      - libmtdev1:arm64
      - libwacom2:arm64
      - libwacom-common:all
      - libgudev-1.0-0:arm64

      # Audio
      - libopenal1:arm64
      - libfluidsynth2:arm64
      - libinstpatch-1.0-2:arm64
      - libsndfile1:arm64
      - libogg0:arm64
      - libvorbis0a:arm64
      - libvorbisenc2:arm64
      - libflac8:arm64
      - libopus0:arm64
      - libsndio7.0:arm64
      - libasound2:arm64
      - libasound2-data:all
      - libsamplerate0:arm64

      # Graphics
      - libsdl2-2.0-0:arm64
      - libfreetype6:arm64
      - libpng16-16:arm64
      - libjpeg62-turbo:arm64
      - libfontconfig1:arm64
      - libharfbuzz0b:arm64
      - libgraphite2-3:arm64
      - libtiff5:arm64
      - libjbig0:arm64
      - libwebp6:arm64
      - liblcms2-2:arm64
      - libopenjp2-7:arm64
      - libdeflate0:arm64

      # MIDI
      - librtmidi5:arm64

      # Networking
      - libslirp0:arm64
      - libvdeplug2:arm64
      - libvdeplug-dev:arm64

      # Serial
      - libserialport0:arm64

      # System libs
      - libglib2.0-0:arm64
      - libdbus-1-3:arm64
      - libsystemd0:arm64
      - libudev1:arm64
      - libpcre2-8-0:arm64
      - libpcre2-16-0:arm64
      - libpcre3:arm64
      - libffi7:arm64
      - libdouble-conversion3:arm64
      - libmd4c0:arm64
      - libmd0:arm64
      - libbsd0:arm64
      - liblz4-1:arm64
      - liblzma5:arm64
      - libzstd1:arm64
      - libexpat1:arm64
      - libselinux1:arm64
      - libmount1:arm64
      - libblkid1:arm64
      - libuuid1:arm64
      - libcrypt1:arm64
      - libp11-kit0:arm64

      # Crypto/TLS
      - libssl1.1:arm64
      - libgcrypt20:arm64
      - libgpg-error0:arm64
      - libgnutls30:arm64
      - libtasn1-6:arm64
      - libnettle8:arm64
      - libhogweed6:arm64
      - libgmp10:arm64
      - libidn11:arm64
      - libidn2-0:arm64
      - libunistring2:arm64
      - libkrb5-3:arm64
      - libgssapi-krb5-2:arm64
      - libk5crypto3:arm64
      - libkrb5support0:arm64
      - libkeyutils1:arm64
      - libcom-err2:arm64

      # Printing (ghostscript for PostScript printer emulation)
      - libgs9:arm64
      - libgs9-common:all
      - libijs-0.35:arm64
      - libjbig2dec0:arm64
      - libpaper1:arm64
      - poppler-data:all
      - libcups2:arm64
      - libavahi-client3:arm64
      - libavahi-common3:arm64
      - libavahi-common-data:arm64
      - fonts-urw-base35:all
      - libice6:arm64
      - libsm6:arm64
      - libicu67:arm64

  runtime:
    env:
      # Ensure Qt finds plugins inside AppDir
      QT_PLUGIN_PATH: '${APPDIR}/usr/lib/aarch64-linux-gnu/qt5/plugins'

  test:
    fedora-like:
      image: arm64v8/fedora:38
      command: ./AppRun --help
    debian-like:
      image: arm64v8/debian:bookworm
      command: ./AppRun --help

AppImage:
  arch: aarch64
  update-information: guess
